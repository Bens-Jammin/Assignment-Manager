<!doctype html>

<html lang="en">
<head>
    <meta charset='UTF-8'/>
    <title>Assignment Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
    <div class="topnav">
        <a class="active" href="#home">Assignment Info</a>
        <a href="{{ url_for('timetable') }}">Class Schedule</a>
        <a href="#contact">Contact</a>
        <a href="#about">About</a>
    </div> 


    <div class="tables-container">
        <div class='assignment-table-container'>
            <div class='save-button' >
                <button type="submit" id="saveButton">Save</button>
            </div>
            {{ assignments_table | safe }}
        </div>

        <div class="minor-table-container">
            <div class="grade-table-container">
                <p style="align-self: center"> GRADES </p>
                {{ grade_table | safe }}
            </div>    

            <div class="todo-table-container">
                <p style="align-self: center;"> TODO </p>
                {{ todo_table | safe }}
            </div>
        </div>
    </div>

    <!-- script for the save button -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var saveButton = document.querySelector('.save-button');
            
            saveButton.addEventListener('click', function() {
              var table = document.querySelector('.assignment-table');
              var rows = table.querySelectorAll('tr');
              var csvContent = '';
          
              // Loop through the rows and construct csv content, skipping the header row
              Array.from(rows).forEach(function(row, index){
                // Skip the header row (usually the first row with index 0)
                if (index === 0) return;
          
                var cols = row.querySelectorAll('td, th');
                var rowData = [];
                cols.forEach(function(col, colIndex) {
                  // Check if the column contains a dropdown box (select element)
                  var select = col.querySelector('select');
                  if (select) {
                    // If it does, use the selected option's text
                    var selectedOption = select.options[select.selectedIndex].text;
                    rowData.push(selectedOption.trim());
                  } else {
                    // Otherwise, use the text content of the cell
                    rowData.push(col.textContent.trim());
                  }
                });
                csvContent += rowData.join(',') + '\n';
              });
          
              // Trigger CSV download with suggested file name and location
              var hiddenElement = document.createElement('a');
              hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
              hiddenElement.target = '_blank';
              // Suggest the file name and location
              hiddenElement.download = 'Ben.csv';
              hiddenElement.click();
            });
          });                                      
        </script>
        
    

</body>

</html>